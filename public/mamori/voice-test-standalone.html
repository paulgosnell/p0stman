<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mamori Voice Agent - Standalone Test</title>

    <!-- Voice Agent Styles -->
    <link rel="stylesheet" href="css/voice-agent.css">

    <!-- Lucid Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

    <!-- ElevenLabs SDK (CDN) - Try multiple sources -->
    <script src="https://unpkg.com/@11labs/client"></script>
    <script>
        // Fallback: Load from jsdelivr if unpkg fails
        window.addEventListener('load', function() {
            if (typeof window.ElevenLabs === 'undefined') {
                console.log('Trying alternate CDN...');
                var script = document.createElement('script');
                script.src = 'https://cdn.jsdelivr.net/npm/@11labs/client@latest/dist/index.umd.js';
                script.onload = function() {
                    console.log('‚úÖ ElevenLabs SDK loaded from jsdelivr');
                };
                script.onerror = function() {
                    console.error('‚ùå Failed to load ElevenLabs SDK from both CDNs');
                };
                document.head.appendChild(script);
            }
        });
    </script>

    <style>
        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 80px 20px 40px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(180deg, #F5F5F5 0%, #FFFFFF 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .test-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .test-header h1 {
            font-size: 2.5rem;
            color: #0F172A;
            margin: 0 0 1rem;
        }

        .test-header p {
            font-size: 1.125rem;
            color: #64748B;
            margin: 0;
        }

        .debug-panel {
            background: rgba(15, 23, 42, 0.05);
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 2rem;
            font-family: monospace;
            font-size: 0.875rem;
        }

        .debug-panel h3 {
            margin-top: 0;
            color: #0F172A;
        }

        .debug-item {
            display: flex;
            gap: 1rem;
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(15, 23, 42, 0.1);
        }

        .debug-item:last-child {
            border-bottom: none;
        }

        .debug-label {
            font-weight: 600;
            color: #0EA5E9;
            min-width: 150px;
        }

        .debug-value {
            color: #64748B;
        }

        .debug-value.success {
            color: #10B981;
        }

        .debug-value.error {
            color: #EF4444;
        }

        .instructions {
            background: rgba(14, 165, 233, 0.1);
            border-left: 4px solid #0EA5E9;
            border-radius: 8px;
            padding: 1.5rem;
            margin-top: 2rem;
        }

        .instructions h3 {
            margin-top: 0;
            color: #0EA5E9;
        }

        .instructions ol {
            margin-bottom: 0;
        }

        .instructions li {
            margin: 0.5rem 0;
            color: #0F172A;
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- Header -->
        <div class="test-header">
            <h1>üé§ Mamori Voice Agent Test</h1>
            <p>Standalone version for testing the voice agent integration</p>
        </div>

        <!-- Voice Agent Panel -->
        <section class="voice-agent-section">
            <div class="container">
                <div class="voice-agent-card">
                    <!-- Header -->
                    <div class="voice-agent-header">
                        <div class="voice-agent-branding">
                            <div class="voice-orb-mini">
                                <div class="orb-core"></div>
                            </div>
                            <div class="voice-agent-title-group">
                                <h3 class="voice-agent-title">Talk to Mamori AI</h3>
                                <p class="voice-agent-subtitle">Ask me anything about health & wellness</p>
                            </div>
                        </div>
                        <button class="voice-toggle-btn" id="voiceToggleBtn">
                            <i data-lucide="mic"></i>
                            <span>Start Conversation</span>
                        </button>
                    </div>

                    <!-- Voice Agent Interface (hidden by default) -->
                    <div class="voice-agent-interface" id="voiceAgentInterface" style="display: none;">
                        <!-- Language Selector -->
                        <div class="voice-language-selector">
                            <i data-lucide="globe"></i>
                            <select id="voiceLanguageSelect" class="language-select">
                                <option value="en">üá¨üáß English</option>
                                <option value="es">üá™üá∏ Espa√±ol</option>
                                <option value="fr">üá´üá∑ Fran√ßais</option>
                                <option value="it">üáÆüáπ Italiano</option>
                                <option value="da">üá©üá∞ Dansk</option>
                                <option value="ar">üá∏üá¶ ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
                            </select>
                        </div>

                        <!-- Waveform Visualization -->
                        <div class="voice-waveform" id="voiceWaveform">
                            <!-- 60 bars generated dynamically by JS -->
                        </div>

                        <!-- Status Display -->
                        <div class="voice-status" id="voiceStatus">
                            <div class="status-indicator status-indicator--idle"></div>
                            <p class="status-text">Click "Start Conversation" to begin talking</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Debug Panel -->
        <div class="debug-panel">
            <h3>üîç Debug Information</h3>
            <div class="debug-item">
                <span class="debug-label">ElevenLabs SDK:</span>
                <span class="debug-value" id="debugSDK">Checking...</span>
            </div>
            <div class="debug-item">
                <span class="debug-label">Lucide Icons:</span>
                <span class="debug-value" id="debugLucide">Checking...</span>
            </div>
            <div class="debug-item">
                <span class="debug-label">Voice Agent Class:</span>
                <span class="debug-value" id="debugVoiceAgent">Checking...</span>
            </div>
            <div class="debug-item">
                <span class="debug-label">Config Loaded:</span>
                <span class="debug-value" id="debugConfig">Checking...</span>
            </div>
            <div class="debug-item">
                <span class="debug-label">Agent ID:</span>
                <span class="debug-value" id="debugAgentId">-</span>
            </div>
            <div class="debug-item">
                <span class="debug-label">API Key:</span>
                <span class="debug-value" id="debugApiKey">-</span>
            </div>
        </div>

        <!-- Instructions -->
        <div class="instructions">
            <h3>üìù How to Use</h3>
            <ol>
                <li><strong>Check Debug Panel:</strong> All items should show "‚úÖ Loaded"</li>
                <li><strong>Add API Key:</strong> Edit <code>js/config.js</code> with your ElevenLabs API key</li>
                <li><strong>Click "Start Conversation":</strong> Allow microphone permissions</li>
                <li><strong>Speak:</strong> Say something like "What supplements help with sleep?"</li>
                <li><strong>Listen:</strong> Wait for AI response</li>
            </ol>
        </div>
    </div>

    <!-- Voice Agent Scripts -->
    <script src="js/config.js"></script>
    <script src="js/voice-agent.js"></script>

    <!-- Initialize Voice Agent & Debug Info -->
    <script>
        // Debug checks
        function updateDebug() {
            const debugSDK = document.getElementById('debugSDK');
            const debugLucide = document.getElementById('debugLucide');
            const debugVoiceAgent = document.getElementById('debugVoiceAgent');
            const debugConfig = document.getElementById('debugConfig');
            const debugAgentId = document.getElementById('debugAgentId');
            const debugApiKey = document.getElementById('debugApiKey');

            // Check ElevenLabs SDK
            if (typeof window.ElevenLabs !== 'undefined') {
                debugSDK.textContent = '‚úÖ Loaded';
                debugSDK.className = 'debug-value success';
            } else {
                debugSDK.textContent = '‚ùå Not loaded';
                debugSDK.className = 'debug-value error';
            }

            // Check Lucide
            if (typeof lucide !== 'undefined') {
                debugLucide.textContent = '‚úÖ Loaded';
                debugLucide.className = 'debug-value success';
            } else {
                debugLucide.textContent = '‚ùå Not loaded';
                debugLucide.className = 'debug-value error';
            }

            // Check Voice Agent Class
            if (typeof MamoriVoiceAgent !== 'undefined') {
                debugVoiceAgent.textContent = '‚úÖ Loaded';
                debugVoiceAgent.className = 'debug-value success';
            } else {
                debugVoiceAgent.textContent = '‚ùå Not loaded';
                debugVoiceAgent.className = 'debug-value error';
            }

            // Check Config
            if (typeof ELEVENLABS_CONFIG !== 'undefined') {
                debugConfig.textContent = '‚úÖ Loaded';
                debugConfig.className = 'debug-value success';

                // Show config values
                debugAgentId.textContent = ELEVENLABS_CONFIG.agentId;
                debugAgentId.className = ELEVENLABS_CONFIG.agentId.startsWith('agent_')
                    ? 'debug-value success'
                    : 'debug-value error';

                const hasApiKey = ELEVENLABS_CONFIG.apiKey &&
                                 ELEVENLABS_CONFIG.apiKey !== 'your_api_key_here' &&
                                 ELEVENLABS_CONFIG.apiKey.startsWith('sk_');
                debugApiKey.textContent = hasApiKey
                    ? '‚úÖ Configured (hidden)'
                    : '‚ö†Ô∏è Not configured';
                debugApiKey.className = hasApiKey
                    ? 'debug-value success'
                    : 'debug-value error';
            } else {
                debugConfig.textContent = '‚ùå Not loaded';
                debugConfig.className = 'debug-value error';
            }
        }

        // Wait for DOM to load
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ Initializing Mamori Voice Agent Test...');

            // Update debug panel
            updateDebug();

            // Initialize Lucide icons
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
                console.log('‚úÖ Lucide icons initialized');
            }

            // Check dependencies
            if (typeof MamoriVoiceAgent === 'undefined') {
                console.error('‚ùå MamoriVoiceAgent not found. Check if voice-agent.js is loaded.');
                return;
            }

            if (typeof ELEVENLABS_CONFIG === 'undefined') {
                console.error('‚ùå ELEVENLABS_CONFIG not found. Check if config.js is loaded.');
                return;
            }

            if (!window.ElevenLabs) {
                console.error('‚ùå ElevenLabs SDK not loaded. Check CDN script.');
                return;
            }

            // Initialize voice agent
            try {
                window.mamoriVoice = new MamoriVoiceAgent({
                    agentId: ELEVENLABS_CONFIG.agentId,
                    apiKey: ELEVENLABS_CONFIG.apiKey,
                    containerId: 'voiceAgentInterface',
                    toggleBtnId: 'voiceToggleBtn',
                    waveformId: 'voiceWaveform',
                    statusId: 'voiceStatus',
                    languageSelectId: 'voiceLanguageSelect'
                });

                console.log('‚úÖ Mamori Voice Agent initialized successfully');

                // Re-update debug panel after initialization
                setTimeout(updateDebug, 100);

            } catch (error) {
                console.error('‚ùå Failed to initialize voice agent:', error);
            }
        });

        // Update debug panel every 5 seconds
        setInterval(updateDebug, 5000);
    </script>
</body>
</html>
